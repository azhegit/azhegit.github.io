<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.74.3 with theme Tranquilpeak 0.4.8-BETA">
<meta name="author" content="阿·哲">
<meta name="keywords" content="">
<meta name="description" content="在虚拟中部署OpenStack">


<meta property="og:description" content="在虚拟中部署OpenStack">
<meta property="og:type" content="article">
<meta property="og:title" content="1-虚拟机OpenStack手动安装部署">
<meta name="twitter:title" content="1-虚拟机OpenStack手动安装部署">
<meta property="og:url" content="https://azhegit.gitee.io/2019/06/1-%E8%99%9A%E6%8B%9F%E6%9C%BAopenstack%E6%89%8B%E5%8A%A8%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/">
<meta property="twitter:url" content="https://azhegit.gitee.io/2019/06/1-%E8%99%9A%E6%8B%9F%E6%9C%BAopenstack%E6%89%8B%E5%8A%A8%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/">
<meta property="og:site_name" content="☀️哲の小窝☀️">
<meta property="og:description" content="在虚拟中部署OpenStack">
<meta name="twitter:description" content="在虚拟中部署OpenStack">
<meta property="og:locale" content="zh-cn">

  
    <meta property="article:published_time" content="2019-06-05T13:53:04">
  
  
    <meta property="article:modified_time" content="2019-06-05T13:53:04">
  
  
  
    
      <meta property="article:section" content="技术">
    
      <meta property="article:section" content="虚拟化&amp;云计算">
    
  
  
    
      <meta property="article:tag" content="openStack">
    
  


<meta name="twitter:card" content="summary">







  <meta property="og:image" content="//www.azheimage.top/markdown-img-paste-20180725100954649.png">
  <meta property="twitter:image" content="//www.azheimage.top/markdown-img-paste-20180725100954649.png">





  <meta property="og:image" content="https://www.azheimage.top/markdown-img-paste-20200805194639512.png">
  <meta property="twitter:image" content="https://www.azheimage.top/markdown-img-paste-20200805194639512.png">


    <title>1-虚拟机OpenStack手动安装部署</title>

    <link rel="icon" href="https://www.azheimage.top/markdown-img-paste-20200805194639512.png">
    

    

    <link rel="canonical" href="https://azhegit.gitee.io/2019/06/1-%E8%99%9A%E6%8B%9F%E6%9C%BAopenstack%E6%89%8B%E5%8A%A8%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://azhegit.gitee.io/css/style-twzjdbqhmnnacqs0pwwdzcdbt8yhv8giawvjqjmyfoqnvazl0dalmnhdkvp7.min.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="2">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://azhegit.gitee.io/">☀️哲の小窝☀️</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="2">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://azhegit.gitee.io/#about">
          <img class="sidebar-profile-picture" src="https://www.azheimage.top/markdown-img-paste-20200805194639512.png" alt="作者的图片" />
        </a>
        <h4 class="sidebar-profile-name">阿·哲</h4>
        
          <h5 class="sidebar-profile-bio">从事Java、Hadoop、Spark、Flink等大数据技术，离线实时解决方案！</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://azhegit.gitee.io/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">首页</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://azhegit.gitee.io/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">分类</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://azhegit.gitee.io/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">标签</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://azhegit.gitee.io/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">归档</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://azhegit.gitee.io/#about">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">关于</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="2"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      1-虚拟机OpenStack手动安装部署
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2019-06-05T13:53:04&#43;08:00">
        
  
  
  
  
    2019 年 六月 5 号
  

      </time>
    
    
  
  
    <span>发布在</span>
    
      <a class="category-link" href="https://azhegit.gitee.io/categories/%e6%8a%80%e6%9c%af">技术</a>, 
    
      <a class="category-link" href="https://azhegit.gitee.io/categories/%e8%99%9a%e6%8b%9f%e5%8c%96%e4%ba%91%e8%ae%a1%e7%ae%97">虚拟化&amp;云计算</a>
    
  

  </div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p>在虚拟中部署OpenStack</p>
<h2 id="虚拟机手动部署">虚拟机手动部署</h2>
<h3 id="环境准备">环境准备</h3>
<p>查看selinux状态
<code>[root@tdh19 ~]# sestatus -v</code></p>
<blockquote>
<p>SELinux status:                 disabled</p>
</blockquote>
<p>如果enabled即为开启状态，需要关闭selinux，下面的命令是需要重启生效
<code>sed -i s#SELINUX=enforcing#SELINUX=disabled# /etc/selinux/config</code>
立即生效通过执行命令：<code>setenforce 0</code></p>
<p>查看防火墙状态
<code>systemctl status firewalld.service</code></p>
<p>如果需要关闭防火墙
启动： <code>systemctl start firewalld</code>
关闭： <code>systemctl stop firewalld</code>
查看状态： <code>systemctl status firewalld</code>
开机禁用  ： <code>systemctl disable firewalld</code>
开机启用  ： <code>systemctl enable firewalld</code></p>
<h3 id="部署">部署</h3>
<h4 id="1安装openstack包">1.安装Openstack包</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum install centos-release-openstack-ocata
yum install https://rdoproject.org/repos/rdo-release.rpm
yum install python-openstackclient
yum install openstack-selinux
</code></pre></div><h4 id="2sql-db">2.SQL DB</h4>
<p><code>yum install mariadb mariadb-server python2-PyMySQL</code></p>
<p><code>vim etc/my.cnf.d/openstack.cnf</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[mysqld]</span>
<span style="color:#a6e22e">default-storage-engine</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">innodb</span>
<span style="color:#a6e22e">innodb_file_per_table</span>
<span style="color:#a6e22e">collation-server</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">utf8_general_ci</span>
<span style="color:#a6e22e">init-connect</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;SET NAMES utf8&#39;</span>
<span style="color:#a6e22e">character-set-server</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">utf8</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">systemctl enable mariadb.service
systemctl start mariadb.service
mysql_secure_installation
</code></pre></div><p>密码 jkl，一路 y 回车</p>
<h4 id="3message-queue">3.Message Queue</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum install rabbitmq-server
systemctl enable rabbitmq-server.service
systemctl start rabbitmq-server.service
<span style="color:#75715e">#添加用户及密码</span>
rabbitmqctl add_user openstack openstack
<span style="color:#75715e">#允许配置、写、读访问 openstack</span>                     
rabbitmqctl set_permissions openstack <span style="color:#e6db74">&#34;.*&#34;</span> <span style="color:#e6db74">&#34;.*&#34;</span> <span style="color:#e6db74">&#34;.*&#34;</span>
<span style="color:#75715e">#查看支持的插件</span>
rabbitmq-plugins list                                 
.........
<span style="color:#f92672">[</span> <span style="color:#f92672">]</span> rabbitmq_management 3.6.2
<span style="color:#75715e">#使用此插件实现 web 管理</span>
.........
<span style="color:#75715e">#启动插件</span>
rabbitmq-plugins enable rabbitmq_management 
    The following plugins have been enabled:
    mochiweb
    webmachine
    rabbitmq_web_dispatch
    amqp_client
    rabbitmq_management_agent
    rabbitmq_management
    Plugin configuration has changed. Restart RabbitMQ <span style="color:#66d9ef">for</span> changes to take effect.
systemctl restart rabbitmq-server.service

lsof -i:15672
</code></pre></div><p>访问RabbitMQ,访问地址是http://10.57.244.174:15672/
默认用户名密码都是guest，浏览器添加openstack用户到组并登陆测试，连不上情况一般是防火墙没有关闭所致！</p>
<p><img src="https://www.azheimage.top/markdown-img-paste-20190521133408913.png" alt="">
<img src="https://www.azheimage.top/markdown-img-paste-20190521133723754.png" alt=""></p>
<h4 id="4安装memcached">4.安装Memcached</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum -y install memcached python-memcached
/etc/sysconfig/memcached
systemctl enable memcached.service
systemctl start memcached.service
</code></pre></div><h4 id="5keystone设置">5.keystone设置</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql <span style="color:#f92672">-</span>u root <span style="color:#f92672">-</span>pjkl
<span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">database</span> keystone;

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> keystone;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">PRIVILEGES</span> <span style="color:#66d9ef">ON</span> keystone.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;keystone&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;keystone&#39;</span>;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">PRIVILEGES</span> <span style="color:#66d9ef">ON</span> keystone.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;keystone&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;keystone&#39;</span>;
 <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> glance;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">PRIVILEGES</span> <span style="color:#66d9ef">ON</span> glance.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;glance&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;glance&#39;</span>;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">PRIVILEGES</span> <span style="color:#66d9ef">ON</span> glance.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;glance&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;glance&#39;</span>;
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> nova;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">PRIVILEGES</span> <span style="color:#66d9ef">ON</span> nova.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;nova&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;nova&#39;</span>;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">PRIVILEGES</span> <span style="color:#66d9ef">ON</span> nova.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;nova&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;nova&#39;</span>;
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> nova_api;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">PRIVILEGES</span> <span style="color:#66d9ef">ON</span> nova_api.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;nova&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;nova&#39;</span>;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">PRIVILEGES</span> <span style="color:#66d9ef">ON</span> nova_api.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;nova&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;nova&#39;</span>;
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> nova_cell0
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">PRIVILEGES</span> <span style="color:#66d9ef">ON</span> nova_cell0.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;nova&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;nova&#39;</span>;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">PRIVILEGES</span> <span style="color:#66d9ef">ON</span> nova_cell0.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;nova&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;nova&#39;</span>;
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> neutron;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">PRIVILEGES</span> <span style="color:#66d9ef">ON</span> neutron.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;neutron&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;neutron&#39;</span>;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">PRIVILEGES</span> <span style="color:#66d9ef">ON</span> neutron.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;neutron&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;neutron&#39;</span>;
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> cinder;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">PRIVILEGES</span> <span style="color:#66d9ef">ON</span> cinder.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;cinder&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;cinder&#39;</span>;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">PRIVILEGES</span> <span style="color:#66d9ef">ON</span> cinder.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;cinder&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;cinder&#39;</span>;
flush <span style="color:#66d9ef">privileges</span>;
<span style="color:#66d9ef">show</span> databases;
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">Database</span>           <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> cinder             <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> glance             <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> information_schema <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> keystone           <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> mysql              <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> neutron            <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> nova               <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> performance_schema <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">8</span> <span style="color:#66d9ef">rows</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">000</span> sec)
</code></pre></div><h4 id="6-安装keystone">6. 安装keystone</h4>
<ol>
<li>yum安装</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum -y install openstack-keystone httpd mod_wsgi
openssl rand -hex <span style="color:#ae81ff">10</span>
&gt;a188ab27240714029cec

<span style="color:#ae81ff">123456789</span>

vim /etc/keystone/keystone.conf
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[DEFAULT]</span>
 <span style="color:#75715e">#设置 token，和上面产生的随机数值一致</span>
<span style="color:#a6e22e">admin_token</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">84940c8359e90532abfd  </span>
<span style="color:#a6e22e">verbose</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">true</span>
<span style="color:#66d9ef">[database]</span>
<span style="color:#a6e22e">connection</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">mysql+pymysql://keystone:keystone@10.57.244.174/keystone</span>
<span style="color:#66d9ef">[memcache]</span>
<span style="color:#a6e22e">servers</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">10.57.244.174:11211</span>
<span style="color:#66d9ef">[revoke]</span>
<span style="color:#a6e22e">driver</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">sql</span>
<span style="color:#66d9ef">[token]</span>
<span style="color:#a6e22e">provider</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">uuid</span>
<span style="color:#a6e22e">driver</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">memcache</span>
</code></pre></div><ol start="2">
<li>
<p>创建数据库表， 使用命令同步
[root@linux-node1 ~]# su -s /bin/sh -c &ldquo;keystone-manage db_sync&rdquo; keystone
No handlers could be found for logger &ldquo;oslo_config.cfg&rdquo;                                          #出现这个信息，不影响后续操作！忽略~
tailf /var/log/keystone/keystone.log
mysql -u keystone -pkeystone</p>
</li>
<li>
<p>创建 keystone 用户</p>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#创建 keystone 用户</span>
keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone
keystone-manage credential_setup --keystone-user keystone --keystone-group keystone
keystone-manage bootstrap --bootstrap-password admin <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>   --bootstrap-admin-url http://10.57.244.174:35357/v3/ <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>   --bootstrap-internal-url http://10.57.244.174:5000/v3/ <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>   --bootstrap-public-url http://10.57.244.174:5000/v3/ <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>   --bootstrap-region-id RegionOne
ln -s /usr/share/keystone/wsgi-keystone.conf /etc/httpd/conf.d/
systemctl enable httpd
systemctl start httpd
</code></pre></div><ol start="4">
<li>创建域/项目/用户和角色</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#加载环境变量</span>
export OS_TOKEN<span style="color:#f92672">=</span>84940c8359e90532abfd  
export OS_URL<span style="color:#f92672">=</span>http://10.57.244.174:35357/v3
export OS_IDENTITY_API_VERSION<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>

openstack project create --domain default --description <span style="color:#e6db74">&#34;Admin Project&#34;</span> admin

keystone-manage bootstrap --bootstrap-password admin <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --bootstrap-admin-url http://10.57.244.174:35357/v3/ <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --bootstrap-internal-url http://10.57.244.174:5000/v3/ <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --bootstrap-public-url http://10.57.244.174:5000/v3/ <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --bootstrap-region-id RegionOne

echo <span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">export OS_TOKEN=123456789
</span><span style="color:#e6db74">export OS_USERNAME=admin
</span><span style="color:#e6db74">export OS_PASSWORD=keystone
</span><span style="color:#e6db74">export OS_AUTH_URL=http://10.57.244.174:35357/v3
</span><span style="color:#e6db74">export OS_IDENTITY_API_VERSION=3
</span><span style="color:#e6db74">export OS_IMAGE_API_VERSION=2
</span><span style="color:#e6db74">&#34;</span>&gt;./admin-openstack.sh

source ./admin-openstack.sh

openstack token issue
openstack project create --domain default --description <span style="color:#e6db74">&#34;Service Project&#34;</span> service

openstack project create --domain default --description <span style="color:#e6db74">&#34;Admin Project&#34;</span> admin


yum -y autoremove openstack-keystone

yum -y install openstack-keystone


fc55025e5a6ab82d333d

history
<span style="color:#ae81ff">62</span>  keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone
<span style="color:#ae81ff">63</span>  keystone-manage bootstrap --bootstrap-password admin   --bootstrap-admin-url http://10.57.244.174:35357/v3/   --bootstrap-internal-url http://10.57.244.174:5000/v3/   --bootstrap-public-url http://10.57.244.174:5000/v3/   --bootstrap-region-id RegionOne
<span style="color:#ae81ff">64</span>  vim admin-openstack.sh
<span style="color:#ae81ff">65</span>  source ./admin-openstack.sh
<span style="color:#ae81ff">66</span>  openstack token issue
<span style="color:#ae81ff">67</span>  openstack project create --domain default --description <span style="color:#e6db74">&#34;Service Project&#34;</span> service
<span style="color:#ae81ff">68</span>  openstack user create --domain default --password<span style="color:#f92672">=</span>glance glance
<span style="color:#ae81ff">69</span>   openstack user list
<span style="color:#ae81ff">70</span>  openstack project create --domain default --description <span style="color:#e6db74">&#34;Admin Project&#34;</span> admin
<span style="color:#ae81ff">71</span>   openstack user list
<span style="color:#ae81ff">72</span>  openstack user create --domain default --password-prompt admin
<span style="color:#ae81ff">73</span>  openstack role create admin
<span style="color:#ae81ff">74</span>  openstack role add --project admin --user admin admin
<span style="color:#ae81ff">75</span>  openstack project create --domain default --description <span style="color:#e6db74">&#34;Demo Project&#34;</span> demo
<span style="color:#ae81ff">76</span>  openstack user create --domain default --password<span style="color:#f92672">=</span>demo demo
<span style="color:#ae81ff">77</span>  openstack role create user
<span style="color:#ae81ff">78</span>  openstack role add --project demo --user demo user
<span style="color:#ae81ff">79</span>  openstack project create --domain default --description <span style="color:#e6db74">&#34;Service Project&#34;</span> service
<span style="color:#ae81ff">80</span>   openstack user list
<span style="color:#ae81ff">81</span>  openstack project list
<span style="color:#ae81ff">82</span>  openstack service create --name keystone --description <span style="color:#e6db74">&#34;OpenStack Identity&#34;</span> identity
<span style="color:#ae81ff">83</span>  openstack endpoint create --region RegionOne identity public http://10.57.244.174:5000/v2.0
<span style="color:#ae81ff">84</span>   openstack endpoint list
</code></pre></div><h4 id="7-安装glance">7. 安装glance</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum install openstack-glance
vim /etc/glance/glance-api.conf
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[database]</span>
<span style="color:#a6e22e">connection</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">mysql+pymysql://glance:glance@10.57.244.174/glance</span>
<span style="color:#66d9ef">[glance_store]</span>
<span style="color:#a6e22e">filesystem_store_datadir</span><span style="color:#f92672">=</span><span style="color:#e6db74">/var/lib/glance/images/</span>
<span style="color:#66d9ef">[keystone_authtoken]</span>
<span style="color:#a6e22e">auth_uri</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">http://10.57.244.174:5000</span>
<span style="color:#a6e22e">auth_url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">http://10.57.244.174:35357</span>
<span style="color:#a6e22e">auth_plugin</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">password</span>
<span style="color:#a6e22e">project_domain_id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">default</span>
<span style="color:#a6e22e">user_domain_id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">default</span>
<span style="color:#a6e22e">project_name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">service</span>
<span style="color:#a6e22e">username</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">glance</span>
<span style="color:#a6e22e">password</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">glance</span>
<span style="color:#66d9ef">[paste_deploy]</span>
<span style="color:#a6e22e">flavor</span><span style="color:#f92672">=</span><span style="color:#e6db74">keystone</span>
</code></pre></div><p>vim /etc/glance/glance-registry.conf</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[database]</span>
<span style="color:#a6e22e">connection</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">mysql+pymysql://glance:glance@10.57.244.174/glance</span>
<span style="color:#66d9ef">[keystone_authtoken]</span>
<span style="color:#a6e22e">auth_uri</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">http://10.57.244.174:5000</span>
<span style="color:#a6e22e">auth_url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">http://10.57.244.174:35357</span>
<span style="color:#a6e22e">auth_plugin</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">password</span>
<span style="color:#a6e22e">project_domain_id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">default</span>
<span style="color:#a6e22e">user_domain_id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">default</span>
<span style="color:#a6e22e">project_name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">service</span>
<span style="color:#a6e22e">username</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">glance</span>
<span style="color:#a6e22e">password</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">glance</span>
<span style="color:#66d9ef">[paste_deploy]</span>
<span style="color:#a6e22e">flavor</span><span style="color:#f92672">=</span><span style="color:#e6db74">keystone</span>
</code></pre></div><p><code>cat /etc/glance/glance-registry.conf|grep -v &quot;^#&quot;|grep -v &quot;^$&quot;</code>
<code>cat /etc/glance/glance-api.conf|grep -v &quot;^#&quot;|grep -v &quot;^$&quot;</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">su -s /bin/sh -c <span style="color:#e6db74">&#34;glance-manage db_sync&#34;</span> glance

<span style="color:#75715e">#在 keystone 上注册</span>
openstack user create --domain default --password-prompt glance glance
openstack role add --project service --user glance admin
openstack service create --name glance --description <span style="color:#e6db74">&#34;OpenStack Image&#34;</span> image
openstack endpoint create --region RegionOne image public http://10.57.244.174:9292
openstack endpoint create --region RegionOne image internal http://10.57.244.174:9292
openstack endpoint create --region RegionOne image admin http://10.57.244.174:9292
systemctl enable openstack-glance-api.service openstack-glance-registry.service
systemctl start openstack-glance-api.service openstack-glance-registry.service

<span style="color:#75715e">#验证</span>
wget http://download.cirros-cloud.net/0.3.5/cirros-0.3.5-x86_64-disk.img
openstack image create <span style="color:#e6db74">&#34;cirros&#34;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --file cirros-0.3.5-x86_64-disk.img <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --disk-format qcow2 --container-format bare <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --public
openstack image list
openstack image delete <span style="color:#e6db74">&#34;cirros&#34;</span>
ll /var/lib/glance/images/
</code></pre></div><blockquote>
<p>下载ios格式镜像，需要用OZ工具制造openstack镜像，具体操作请见另一篇博客：
实际生产环境下，肯定要使用ios镜像进行制作了
<a href="http://www.cnblogs.com/kevingrace/p/5821823.html">http://www.cnblogs.com/kevingrace/p/5821823.html</a>
或者直接下载centos的qcow2格式镜像进行上传，qcow2格式镜像直接就可以在openstack里使用，不需要进行格式转换！
下载地址：http://cloud.centos.org/centos，可以到里面下载centos5/6/7的qcow2格式的镜像</p>
</blockquote>
<p>4、启动 glance
systemctl enable openstack-glance-api
systemctl enable openstack-glance-registry
systemctl start openstack-glance-api
systemctl start openstack-glance-registry
netstat -lnutp |grep 9191 #registry</p>
<blockquote>
<p>tcp 0 0 0.0.0.0:9191 0.0.0.0:* LISTEN 24890/python2</p>
</blockquote>
<p>netstat -lnutp |grep 9292 #api</p>
<blockquote>
<p>tcp 0 0 0.0.0.0:9292 0.0.0.0:* LISTEN 24877/python2</p>
</blockquote>
<h4 id="8-安装nova">8. 安装nova</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">openstack user create --domain default --password-prompt nova nova
openstack role add --project service --user nova admin
openstack service create --name nova --description <span style="color:#e6db74">&#34;OpenStack Compute&#34;</span> compute

openstack endpoint create --region RegionOne compute public http://10.57.244.174:8774/v2.1
openstack endpoint create --region RegionOne compute internal http://10.57.244.174:8774/v2.1

openstack user create --domain default --password-prompt placement
openstack role add --project service --user placement admin
openstack service create --name placement --description <span style="color:#e6db74">&#34;Placement API&#34;</span> placement
openstack endpoint create --region RegionOne placement public http://10.57.244.174:8778
openstack endpoint create --region RegionOne placement internal http://10.57.244.174:8778

yum install openstack-nova-api <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  openstack-nova-conductor <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  openstack-nova-console <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  openstack-nova-novncproxy <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  openstack-nova-scheduler <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  openstack-nova-placement-api

vim /etc/nova/nova.conf
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[DEFAULT]</span>
<span style="color:#a6e22e">rpc_backend</span><span style="color:#f92672">=</span><span style="color:#e6db74">rabbit</span>
<span style="color:#a6e22e">my_ip</span><span style="color:#f92672">=</span><span style="color:#e6db74">10.57.244.174</span>
<span style="color:#a6e22e">debug</span><span style="color:#f92672">=</span><span style="color:#e6db74">true</span>
<span style="color:#a6e22e">allow_resize_to_same_host</span><span style="color:#f92672">=</span><span style="color:#e6db74">True</span>
<span style="color:#a6e22e">connection</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">mysql+pymysql://nova:nova@10.57.244.174/nova</span>
<span style="color:#66d9ef">[api_database]</span>
<span style="color:#a6e22e">connection</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">mysql+pymysql://nova:nova@10.57.244.174/nova_api</span>
<span style="color:#66d9ef">[cache]</span>
<span style="color:#a6e22e">backend</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">oslo_cache.memcache_pool</span>
<span style="color:#a6e22e">enabled</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">True</span>
<span style="color:#a6e22e">memcache_servers</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">10.57.244.174:11211</span>

<span style="color:#66d9ef">[keystone_authtoken]</span>
<span style="color:#a6e22e">auth_uri</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">http://10.57.244.174:5000</span>
<span style="color:#a6e22e">auth_url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">http://10.57.244.174:35357</span>
<span style="color:#a6e22e">auth_plugin</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">password</span>
<span style="color:#a6e22e">project_domain_id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">default</span>
<span style="color:#a6e22e">user_domain_id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">default</span>
<span style="color:#a6e22e">project_name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">service</span>
<span style="color:#a6e22e">username</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">nova</span>
<span style="color:#a6e22e">password</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">nova</span>
<span style="color:#66d9ef">[libvirt]</span>
<span style="color:#a6e22e">virt_type</span><span style="color:#f92672">=</span><span style="color:#e6db74">kvm                                  #如果控制节点也作为计算节点（单机部署的话），这一行也添加上（这行是计算节点配置的）</span>
<span style="color:#66d9ef">[neutron]</span>
<span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">http://10.57.244.174:9696</span>
<span style="color:#a6e22e">auth_url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">http://10.57.244.174:35357</span>
<span style="color:#a6e22e">auth_plugin</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">password</span>
<span style="color:#a6e22e">project_domain_id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">default</span>
<span style="color:#a6e22e">user_domain_id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">default</span>
<span style="color:#a6e22e">region_name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">RegionOne</span>
<span style="color:#a6e22e">project_name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">service</span>
<span style="color:#a6e22e">username</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">neutron</span>
<span style="color:#a6e22e">password</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">neutron</span>
<span style="color:#a6e22e">service_metadata_proxy</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">True</span>
<span style="color:#a6e22e">metadata_proxy_shared_secret</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">neutron</span>
<span style="color:#a6e22e">lock_path</span><span style="color:#f92672">=</span><span style="color:#e6db74">/var/lib/nova/tmp</span>
<span style="color:#66d9ef">[oslo_messaging_rabbit]</span>
<span style="color:#a6e22e">rabbit_host</span><span style="color:#f92672">=</span><span style="color:#e6db74">10.57.244.174</span>
<span style="color:#a6e22e">rabbit_port</span><span style="color:#f92672">=</span><span style="color:#e6db74">5672</span>
<span style="color:#a6e22e">rabbit_userid</span><span style="color:#f92672">=</span><span style="color:#e6db74">openstack</span>
<span style="color:#a6e22e">rabbit_password</span><span style="color:#f92672">=</span><span style="color:#e6db74">openstack</span>
<span style="color:#66d9ef">[vnc]</span>
<span style="color:#a6e22e">novncproxy_base_url</span><span style="color:#f92672">=</span><span style="color:#e6db74">http://10.57.244.174:6080/vnc_auto.html      #如果控制节点也作为计算节点（单机部署的话），这一行也添加上（这行是计算节点配置的），配置控制节点的公网ip</span>
<span style="color:#a6e22e">vncserver_listen</span><span style="color:#f92672">=</span> <span style="color:#e6db74">$my_ip</span>
<span style="color:#a6e22e">vncserver_proxyclient_address</span><span style="color:#f92672">=</span> <span style="color:#e6db74">$my_ip</span>
<span style="color:#a6e22e">keymap</span><span style="color:#f92672">=</span><span style="color:#e6db74">en-us           #如果控制节点也作为计算节点（单机部署的话），这一行也添加上（这行是计算节点配置的）</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">su -s /bin/sh -c <span style="color:#e6db74">&#34;nova-manage api_db sync&#34;</span> nova
su -s /bin/sh -c <span style="color:#e6db74">&#34;nova-manage cell_v2 map_cell0&#34;</span> nova
su -s /bin/sh -c <span style="color:#e6db74">&#34;nova-manage cell_v2 create_cell --name=cell1 --verbose&#34;</span> nova
su -s /bin/sh -c <span style="color:#e6db74">&#34;nova-manage db sync&#34;</span> nova
nova-manage cell_v2 list_cells

systemctl enable openstack-nova-api.service <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  openstack-nova-consoleauth.service openstack-nova-scheduler.service <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  openstack-nova-conductor.service openstack-nova-novncproxy.service

systemctl start openstack-nova-api.service <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  openstack-nova-consoleauth.service openstack-nova-scheduler.service <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  openstack-nova-conductor.service openstack-nova-novncproxy.service

openstack hypervisor list

su -s /bin/sh -c <span style="color:#e6db74">&#34;nova-manage cell_v2 discover_hosts --verbose&#34;</span> nova <span style="color:#75715e"># 这一步也也可在nova.conf中配置 discover_hosts_in_cells_interval 自动发信compute node</span>
yum install openstack-nova-compute

systemctl enable libvirtd.service openstack-nova-compute.service

systemctl start libvirtd.service openstack-nova-compute.service

openstack compute service list <span style="color:#75715e"># 应该有四个服务时up的(conductor, consoleauth, scheduler, compute)</span>
openstack catalog list <span style="color:#75715e"># 应该有4中类型的endpoint(compute,placement, image, identity)</span>

<span style="color:#75715e">### 网络服务（neutron）</span>
openstack user create --domain default --password-prompt neutron
openstack service create --name neutron --description <span style="color:#e6db74">&#34;OpenStack Networking&#34;</span> network

openstack endpoint create --region RegionOne network public http://10.57.244.174:9696
openstack endpoint create --region RegionOne network internal http://10.57.244.174:9696
openstack endpoint create --region RegionOne network admin http://10.57.244.174:9696

yum install openstack-neutron openstack-neutron-ml2 openstack-neutron-linuxbridge python-neutronclient ebtables ipset
vim /etc/neutron/neutron.conf
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[DEFAULT]</span>
<span style="color:#a6e22e">state_path</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">/var/lib/neutron</span>
<span style="color:#a6e22e">core_plugin</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">ml2</span>
<span style="color:#a6e22e">auth_strategy</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">keystone</span>
<span style="color:#a6e22e">nova_url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">http://10.57.244.174:8774/v2</span>
<span style="color:#a6e22e">rpc_backend</span><span style="color:#f92672">=</span><span style="color:#e6db74">rabbit</span>
<span style="color:#66d9ef">[keystone_authtoken]</span>
<span style="color:#a6e22e">auth_uri</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">http://10.57.244.174:5000</span>
<span style="color:#a6e22e">auth_url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">http://10.57.244.174:35357</span>
<span style="color:#a6e22e">auth_plugin</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">password</span>
<span style="color:#a6e22e">project_domain_id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">default</span>
<span style="color:#a6e22e">user_domain_id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">default</span>
<span style="color:#a6e22e">project_name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">service</span>
<span style="color:#a6e22e">username</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">neutron</span>
<span style="color:#a6e22e">password</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">neutron</span>
<span style="color:#a6e22e">memcached_servers</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">10.57.244.174:11211</span>
<span style="color:#66d9ef">[database]</span>
<span style="color:#a6e22e">connection</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">mysql+pymysql://neutron:neutron@10.57.244.174/neutron</span>
<span style="color:#66d9ef">[nova]</span>
<span style="color:#a6e22e">auth_url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">http://10.57.244.174:35357</span>
<span style="color:#a6e22e">auth_plugin</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">password</span>
<span style="color:#a6e22e">project_domain_id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">default</span>
<span style="color:#a6e22e">user_domain_id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">default</span>
<span style="color:#a6e22e">region_name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">RegionOne</span>
<span style="color:#a6e22e">project_name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">service</span>
<span style="color:#a6e22e">username</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">nova</span>
<span style="color:#a6e22e">password</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">nova</span>
<span style="color:#66d9ef">[oslo_concurrency]</span>
<span style="color:#a6e22e">lock_path</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">/var/lib/neutron/tmp</span>
<span style="color:#66d9ef">[oslo_messaging_rabbit]</span>
<span style="color:#a6e22e">rabbit_host</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">10.57.244.174</span>
<span style="color:#a6e22e">rabbit_port</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">5672</span>
<span style="color:#a6e22e">rabbit_userid</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">openstack</span>
<span style="color:#a6e22e">rabbit_password</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">openstack</span>
</code></pre></div><p>vim /etc/neutron/plugins/ml2/ml2_conf.ini</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[ml2]</span>
<span style="color:#a6e22e">type_drivers</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">flat,vlan,gre,vxlan,geneve</span>
<span style="color:#a6e22e">tenant_network_types</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">vlan,gre,vxlan,geneve</span>
<span style="color:#a6e22e">mechanism_drivers</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">openvswitch,linuxbridge</span>
<span style="color:#a6e22e">extension_drivers</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">port_security</span>
<span style="color:#66d9ef">[ml2_type_flat]</span>
<span style="color:#a6e22e">flat_networks</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">physnet1</span>
<span style="color:#66d9ef">[ml2_type_vlan]</span>
<span style="color:#66d9ef">[ml2_type_gre]</span>
<span style="color:#66d9ef">[ml2_type_vxlan]</span>
<span style="color:#66d9ef">[ml2_type_geneve]</span>
<span style="color:#66d9ef">[securitygroup]</span>
<span style="color:#a6e22e">enable_ipset</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">True</span>
</code></pre></div><p>vim /etc/neutron/plugins/ml2/linuxbridge_agent.ini</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[linux_bridge]</span>
<span style="color:#a6e22e">physical_interface_mappings</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">physnet1:enp0s3</span>
<span style="color:#66d9ef">[vxlan]</span>
<span style="color:#a6e22e">enable_vxlan</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">false</span>
<span style="color:#66d9ef">[agent]</span>
<span style="color:#a6e22e">prevent_arp_spoofing</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">True</span>
<span style="color:#66d9ef">[securitygroup]</span>
<span style="color:#a6e22e">firewall_driver</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span>
<span style="color:#a6e22e">enable_security_group</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">True</span>
</code></pre></div><p>vim /etc/neutron/dhcp_agent.ini</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#a6e22e">interface_driver</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">neutron.agent.linux.interface.BridgeInterfaceDriver</span>
<span style="color:#a6e22e">dhcp_driver</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">neutron.agent.linux.dhcp.Dnsmasq</span>
<span style="color:#a6e22e">enable_isolated_metadata</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">true</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini
openstack user create --domain default --password<span style="color:#f92672">=</span>neutron neutron
openstack role add --project service --user neutron admin

su -s /bin/sh -c <span style="color:#e6db74">&#34;neutron-db-manage --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head&#34;</span> neutron

systemctl restart openstack-nova-api.service

systemctl enable neutron-server.service <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  neutron-linuxbridge-agent.service neutron-dhcp-agent.service <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  neutron-metadata-agent.service
systemctl start neutron-server.service <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  neutron-linuxbridge-agent.service neutron-dhcp-agent.service <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  neutron-metadata-agent.service
<span style="color:#75715e">#option 2 网络才执行下</span>
systemctl enable neutron-l3-agent.service
systemctl start neutron-l3-agent.service

systemctl restart openstack-nova-compute.service
systemctl enable neutron-linuxbridge-agent.service
systemctl start neutron-linuxbridge-agent.service


openstack extension list --network

 Option 1: Provider networks

openstack network agent list
</code></pre></div><h4 id="9-安装web">9. 安装WEB</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum -y install openstack-dashboard
vim /etc/openstack-dashboard/local_settings
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#a6e22e">OPENSTACK_HOST</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;127.0.0.1&#34;                                 #更改为keystone机器地址</span>
<span style="color:#a6e22e">OPENSTACK_KEYSTONE_DEFAULT_ROLE</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;user&#34;              #默认的角色</span>
<span style="color:#a6e22e">ALLOWED_HOSTS</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">[&#39;*&#39;]                                                 #允许所有主机访问</span>
<span style="color:#a6e22e">CACHES</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">{
</span><span style="color:#e6db74">    &#39;default&#39;: {
</span><span style="color:#e6db74">        &#39;BACKEND&#39;: &#39;django.core.cache.backends.memcached.MemcachedCache&#39;,
</span><span style="color:#e6db74">        &#39;LOCATION&#39;: &#39;10.57.244.174:11211&#39;,
</span><span style="color:#e6db74">    },</span>
<span style="color:#a6e22e">}</span>
<span style="color:#a6e22e">TIME_ZONE</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Asia/Shanghai&#34;                        #设置时区</span>
</code></pre></div><p>systemctl restart httpd</p>
<h3 id="错误">错误</h3>
<p>[root@localhost ~]#   source ./admin-openstack.sh
[root@localhost ~]# openstack project create &ndash;domain default &ndash;description &ldquo;Admin Project&rdquo; admin
The request you have made requires authentication. (HTTP 401) (Request-ID: req-723d9e6f-fddd-40bc-a7f0-222b46beb2e5)</p>
<p>tailf /var/log/keystone/keystone.log</p>
<blockquote>
<p>2019-05-21 18:00:45.816 21702 WARNING keystone.auth.plugins.core [req-723d9e6f-fddd-40bc-a7f0-222b46beb2e5 - - - - -] Could not find domain: default.: DomainNotFound: Could not find domain: default.
2019-05-21 18:00:45.819 21702 WARNING keystone.server.flask.application [req-723d9e6f-fddd-40bc-a7f0-222b46beb2e5 - - - - -] Authorization failed. The request you have made requires authentication. from 10.57.244.174: Unauthorized: The request you have made requires authentication</p>
</blockquote>
<p>echo &quot;
export OS_PROJECT_DOMAIN_NAME=default
export OS_USER_DOMAIN_NAME=default
export OS_PROJECT_NAME=admin
export OS_USERNAME=admin
export OS_PASSWORD=admin
export OS_AUTH_URL=http://10.57.244.174:35357/v3
export OS_IDENTITY_API_VERSION=3
export OS_IMAGE_API_VERSION=2
&ldquo;&gt;./admin-openstack.sh</p>
<p>yum安装dashboard的时候
错误：软件包：python-django-1.8.14-1.el7.noarch (centos-openstack-ocata)
需要：python-django-bash-completion = 1.8.14-1.el7
可用: python-django-bash-completion-1.8.14-1.el7.noarch (centos-openstack-ocata)
python-django-bash-completion = 1.8.14-1.el7
正在安装: python-django-bash-completion-1.11.20-1.el7.noarch (openstack-stein)
python-django-bash-completion = 1.11.20-1.el7
您可以尝试添加 &ndash;skip-broken 选项来解决该问题
您可以尝试执行：rpm -Va &ndash;nofiles &ndash;nodigest</p>
<p>删除openstack-stein的yum源</p>
<p>Target WSGI script &lsquo;/usr/bin/keystone-wsgi-public&rsquo; cannot be loaded as Python module.</p>
              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">标签</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://azhegit.gitee.io/tags/openstack/">openStack</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://azhegit.gitee.io/2019/06/2-%E6%B5%8B%E8%AF%95%E6%9C%BA%E6%89%8B%E5%8A%A8%E5%AE%89%E8%A3%85/" data-tooltip="2-测试机手动安装">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">下一篇</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://azhegit.gitee.io/2019/06/0-openstack%E7%A0%94%E7%A9%B6/" data-tooltip="0-OpenStack研究">
              
                  <span class="hide-xs hide-sm text-small icon-mr">上一篇</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2023 阿·哲. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="2">
        <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://azhegit.gitee.io/2019/06/2-%E6%B5%8B%E8%AF%95%E6%9C%BA%E6%89%8B%E5%8A%A8%E5%AE%89%E8%A3%85/" data-tooltip="2-测试机手动安装">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">下一篇</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://azhegit.gitee.io/2019/06/0-openstack%E7%A0%94%E7%A9%B6/" data-tooltip="0-OpenStack研究">
              
                  <span class="hide-xs hide-sm text-small icon-mr">上一篇</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="2">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.azheimage.top/markdown-img-paste-20200805194639512.png" alt="作者的图片" />
    
    <h4 id="about-card-name">阿·哲</h4>
    
      <div id="about-card-bio">从事Java、Hadoop、Spark、Flink等大数据技术，离线实时解决方案！</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        码农🙈
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        杭州
      </div>
    
  </div>
</div>

    

    
  
    <div id="cover" style="background-image:url('https://www.azheimage.top/markdown-img-paste-20200805172727209.png');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://azhegit.gitee.io/js/script-pcw6v3xilnxydl1vddzazdverrnn9ctynvnxgwho987mfyqkuylcb1nlt.min.js"></script>


<script lang="javascript">
window.onload = updateMinWidth;
window.onresize = updateMinWidth;
document.getElementById("sidebar").addEventListener("transitionend", updateMinWidth);
function updateMinWidth() {
  var sidebar = document.getElementById("sidebar");
  var main = document.getElementById("main");
  main.style.minWidth = "";
  var w1 = getComputedStyle(main).getPropertyValue("min-width");
  var w2 = getComputedStyle(sidebar).getPropertyValue("width");
  var w3 = getComputedStyle(sidebar).getPropertyValue("left");
  main.style.minWidth = `calc(${w1} - ${w2} - ${w3})`;
}
</script>

<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'https:\/\/azhegit.gitee.io\/2019\/06\/1-%E8%99%9A%E6%8B%9F%E6%9C%BAopenstack%E6%89%8B%E5%8A%A8%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2\/';
          
            this.page.identifier = '\/2019\/06\/1-%E8%99%9A%E6%8B%9F%E6%9C%BAopenstack%E6%89%8B%E5%8A%A8%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'hugo-tranquilpeak-theme';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  




    
  </body>
</html>

