---
categories:
- 技术
- 大数据
date: '2019-12-28 18:30:02+08:00'
tags:
- flink
thumbnailImage: //d1u9biwaxjngwg.cloudfront.net/welcome-to-tranquilpeak/city-750.jpg
title: 2-水印watermark
---
watermark代码测试
<!--more-->
什么时候出发窗口计算？

1. 窗口内有数据
2. watermark时间大于窗口结束时间

比如waterMark设置为10S，窗口5s
那么时间区间[00,05)有数据，并且watermark为6秒时，会触发计算

>A1|2019-12-28 16:51:00
A1|2019-12-28 16:51:07
A1|2019-12-28 16:51:08


数据:(A1,2019-12-28 16:51:00) 当前最大时间:2019-12-28 16:51:00 上一个watermark：1970-01-01 07:59:55 当前watermark：2019-12-28 16:50:55
数据:(A1,2019-12-28 16:51:07) 当前最大时间:2019-12-28 16:51:07 上一个watermark：2019-12-28 16:50:55 当前watermark：2019-12-28 16:51:02
数据:(A1,2019-12-28 16:51:08) 当前最大时间:2019-12-28 16:51:08 上一个watermark：2019-12-28 16:51:02 当前watermark：2019-12-28 16:51:03

```json
{
  "key" : "A1",
  "count" : 1,
  "array" : [ {
    "A1" : "2019-12-28 16:51:00"
  } ],
  "dtStartTime" : "2019-12-28 16:51:00",
  "dataEndTime" : "2019-12-28 16:51:00",
  "winStart" : "2019-12-28 16:51:00",
  "windoEnd" : "2019-12-28 16:51:03"
}```
