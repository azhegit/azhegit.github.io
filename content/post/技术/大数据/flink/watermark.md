---
categories:
- 技术
- 大数据
date: '2019-12-28 13:06:59+08:00'
tags:
- flink
thumbnailImage: //www.azheimage.top/markdown-img-paste-20190110143922992.png
title: watermark
---

什么时候出发窗口计算？

<!--more-->

1. 窗口内有数据
2. watermark 时间大于窗口结束时间

比如 waterMark 设置为 10S，窗口 5s
那么时间区间[00,05)有数据，并且 watermark 为 6 秒时，会触发计算

> A1|2019-12-28 16:51:00
> A1|2019-12-28 16:51:07
> A1|2019-12-28 16:51:08

数据:(A1,2019-12-28 16:51:00) 当前最大时间:2019-12-28 16:51:00 上一个 watermark：1970-01-01 07:59:55 当前 watermark：2019-12-28 16:50:55
数据:(A1,2019-12-28 16:51:07) 当前最大时间:2019-12-28 16:51:07 上一个 watermark：2019-12-28 16:50:55 当前 watermark：2019-12-28 16:51:02
数据:(A1,2019-12-28 16:51:08) 当前最大时间:2019-12-28 16:51:08 上一个 watermark：2019-12-28 16:51:02 当前 watermark：2019-12-28 16:51:03

{
"key" : "A1",
"count" : 1,
"array" : [ {
"A1" : "2019-12-28 16:51:00"
} ],
"dtStartTime" : "2019-12-28 16:51:00",
"dataEndTime" : "2019-12-28 16:51:00",
"winStart" : "2019-12-28 16:51:00",
"windoEnd" : "2019-12-28 16:51:03"
}
